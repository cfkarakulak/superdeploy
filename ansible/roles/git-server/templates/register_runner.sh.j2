#!/bin/bash
# Forgejo Runner Registration Script
# Generated by Ansible

set -e

TOKEN="$1"

if [ -z "$TOKEN" ]; then
  echo "Usage: $0 <REGISTRATION_TOKEN>"
  echo ""
  echo "Get token from: http://{{ ansible_host }}:3001 → Settings → Actions → Runners"
  exit 1
fi

cd /opt/forgejo-runner

if [ -f .runner ]; then
  echo "Runner already registered. To re-register, remove .runner file first."
  exit 1
fi

forgejo-runner register --no-interactive \
  --instance "http://localhost:3001" \
  --token "$TOKEN" \
  --name "superdeploy-runner" \
  --labels "docker:docker://node:20,ubuntu-latest:docker://catthehacker/ubuntu:act-latest"

echo ""
echo "✅ Runner registered successfully!"
echo ""
echo "Start the runner:"
echo "  sudo systemctl enable forgejo-runner"
echo "  sudo systemctl start forgejo-runner"
echo "  sudo systemctl status forgejo-runner"
echo ""

