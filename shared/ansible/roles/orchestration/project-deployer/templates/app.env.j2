# =============================================================================
# Environment file for {{ item.key }} application
# =============================================================================
# Auto-generated by project-deployer role from secrets.yml
# DO NOT EDIT MANUALLY - Changes will be overwritten
# =============================================================================

# Project configuration
PROJECT_NAME={{ project_name }}
APP_NAME={{ item.key }}
PORT={{ item.value.port }}

# Network configuration
NETWORK_NAME={{ network_name }}
NETWORK_SUBNET={{ network_subnet }}

# Paths
DATA_PATH={{ project_base_path }}/data/{{ item.key }}
LOGS_PATH={{ project_base_path }}/logs/{{ item.key }}

{% if monitoring_enabled %}
# Monitoring configuration
MONITORING_ENABLED=true
PROMETHEUS_ENDPOINT={{ prometheus_endpoint }}
{% endif %}

# =============================================================================
# Shared Secrets (from secrets.yml)
# =============================================================================
{% if project_secrets is defined and project_secrets.secrets is defined and project_secrets.secrets.shared is defined %}
{% for key, value in project_secrets.secrets.shared.items() %}
{{ key }}={{ value }}
{% endfor %}
{% endif %}

# =============================================================================
# App-Specific Secrets (from secrets.yml)
# =============================================================================
{% if project_secrets is defined and project_secrets[item.key] is defined and project_secrets[item.key] is not none %}
{% for key, value in project_secrets[item.key].items() %}
{{ key }}={{ value }}
{% endfor %}
{% endif %}

# =============================================================================
# Environment Aliases (from secrets.yml)
# =============================================================================
{% if env_aliases is defined and env_aliases[item.key] is defined and env_aliases[item.key] is not none %}
{% for alias_key, alias_value in env_aliases[item.key].items() %}
{%   if alias_value is string and alias_value[0]|upper == alias_value[0] and '_' in alias_value %}
{#     It's a reference to another variable #}
{%     if project_secrets.secrets is defined and project_secrets.secrets.shared is defined and project_secrets.secrets.shared is not none and project_secrets.secrets.shared[alias_value] is defined %}
{{ alias_key }}={{ project_secrets.secrets.shared[alias_value] }}
{%     else %}
{{ alias_key }}=${{"{{ " }}{{ alias_value }}{{"}}"}}}
{%     endif %}
{%   else %}
{#     It's a static value #}
{{ alias_key }}={{ alias_value }}
{%   endif %}
{% endfor %}
{% endif %}
