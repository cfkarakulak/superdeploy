# Environment Variables

This document lists all environment variables required by SuperDeploy. These are **truly global settings** that apply across all projects.

## Overview

SuperDeploy uses environment variables instead of a centralized `.env` file to maintain proper configuration scoping:

- **Global settings** (documented here): Set as environment variables on your system
- **Project-specific settings**: Defined in `projects/<project>/project.yml`
- **Application secrets**: Managed via GitHub Secrets and Forgejo

## Required Environment Variables

### GCP Infrastructure

These variables configure your Google Cloud Platform infrastructure:

```bash
# GCP Project Configuration
export GCP_PROJECT_ID="your-gcp-project-id"
export GCP_REGION="us-central1"
export GCP_ZONE="us-central1-a"
```

**Description:**
- `GCP_PROJECT_ID`: Your Google Cloud project ID
- `GCP_REGION`: GCP region for resources (e.g., us-central1, europe-west1)
- `GCP_ZONE`: GCP zone within the region (e.g., us-central1-a)

### SSH Access

SSH keys for accessing deployed VMs:

```bash
# SSH Configuration
export SSH_KEY_PATH="$HOME/.ssh/superdeploy_deploy"
export SSH_PUBLIC_KEY_PATH="$HOME/.ssh/superdeploy_deploy.pub"
export SSH_USER="superdeploy"
```

**Description:**
- `SSH_KEY_PATH`: Path to private SSH key for VM access
- `SSH_PUBLIC_KEY_PATH`: Path to public SSH key (will be added to VMs)
- `SSH_USER`: Username for SSH connections (default: superdeploy)

**Setup:**
```bash
# Generate SSH key pair if you don't have one
ssh-keygen -t ed25519 -f ~/.ssh/superdeploy_deploy -C "superdeploy"
```

### Docker Registry

Docker registry credentials for pushing/pulling images:

```bash
# Docker Registry Configuration
export DOCKER_REGISTRY="docker.io"
export DOCKER_ORG="your-docker-org"
export DOCKER_USERNAME="your-docker-username"
export DOCKER_TOKEN="your-docker-access-token"
```

**Description:**
- `DOCKER_REGISTRY`: Docker registry URL (default: docker.io for Docker Hub)
- `DOCKER_ORG`: Your Docker organization or username
- `DOCKER_USERNAME`: Docker registry username
- `DOCKER_TOKEN`: Docker access token or password

**Setup:**
```bash
# Create Docker access token at: https://hub.docker.com/settings/security
```

### Forgejo Git Server

Forgejo is the self-hosted Git server used for deployment orchestration:

```bash
# Forgejo Configuration
export FORGEJO_ORG="your-org-name"
export FORGEJO_ADMIN_USER="admin"
export FORGEJO_ADMIN_PASSWORD="secure-password"
export FORGEJO_ADMIN_EMAIL="admin@example.com"
export FORGEJO_PAT="your-personal-access-token"
export REPO_SUPERDEPLOY="superdeploy"
```

**Description:**
- `FORGEJO_ORG`: Organization name in Forgejo
- `FORGEJO_ADMIN_USER`: Admin username for Forgejo
- `FORGEJO_ADMIN_PASSWORD`: Admin password (used during initial setup)
- `FORGEJO_ADMIN_EMAIL`: Admin email address
- `FORGEJO_PAT`: Personal Access Token for API access
- `REPO_SUPERDEPLOY`: Repository name for deployment workflows

**Note:** The PAT is generated after Forgejo is deployed. See deployment docs for details.

### GitHub Integration

GitHub token for automating repository setup:

```bash
# GitHub Configuration
export GITHUB_TOKEN="ghp_your_github_token"
```

**Description:**
- `GITHUB_TOKEN`: GitHub Personal Access Token with repo permissions

**Setup:**
```bash
# Create token at: https://github.com/settings/tokens
# Required scopes: repo, workflow
```

## Optional Environment Variables

### Monitoring

If you enable monitoring for your projects:

```bash
# Monitoring Configuration
export GRAFANA_ADMIN_USER="admin"
export GRAFANA_ADMIN_PASSWORD="secure-password"
export ALERT_EMAIL="alerts@example.com"
```

**Description:**
- `GRAFANA_ADMIN_USER`: Grafana admin username
- `GRAFANA_ADMIN_PASSWORD`: Grafana admin password
- `ALERT_EMAIL`: Email address for monitoring alerts

### SMTP (Email Notifications)

For sending email notifications:

```bash
# SMTP Configuration
export SMTP_USERNAME="your-email@example.com"
export SMTP_PASSWORD="your-app-password"
```

**Description:**
- `SMTP_USERNAME`: SMTP username (usually your email)
- `SMTP_PASSWORD`: SMTP password or app-specific password

### Feature Toggles

Control infrastructure-level features:

```bash
# Feature Toggles
export USE_REMOTE_STATE="false"
export ENABLE_MONITORING="true"
```

**Description:**
- `USE_REMOTE_STATE`: Use remote Terraform state (true/false)
- `ENABLE_MONITORING`: Enable monitoring infrastructure (true/false)

## Network Configuration (Auto-Generated)

These variables are automatically populated by Terraform after deployment:

```bash
# Auto-generated by Terraform (do not set manually)
CORE_EXTERNAL_IP=<assigned-by-terraform>
CORE_INTERNAL_IP=<assigned-by-terraform>
SCRAPE_EXTERNAL_IP=<assigned-by-terraform>
SCRAPE_INTERNAL_IP=<assigned-by-terraform>
PROXY_EXTERNAL_IP=<assigned-by-terraform>
PROXY_INTERNAL_IP=<assigned-by-terraform>
```

## Setting Environment Variables

### Option 1: Shell Profile (Recommended)

Add to your `~/.bashrc`, `~/.zshrc`, or equivalent:

```bash
# SuperDeploy Configuration
export GCP_PROJECT_ID="your-gcp-project-id"
export GCP_REGION="us-central1"
export GCP_ZONE="us-central1-a"
export SSH_KEY_PATH="$HOME/.ssh/superdeploy_deploy"
export SSH_PUBLIC_KEY_PATH="$HOME/.ssh/superdeploy_deploy.pub"
export SSH_USER="superdeploy"
export DOCKER_REGISTRY="docker.io"
export DOCKER_ORG="your-docker-org"
export DOCKER_USERNAME="your-docker-username"
export DOCKER_TOKEN="your-docker-token"
export GITHUB_TOKEN="your-github-token"
```

Then reload your shell:
```bash
source ~/.bashrc  # or ~/.zshrc
```

### Option 2: direnv (Project-Specific)

If you use [direnv](https://direnv.net/), create a `.envrc` file in your superdeploy directory:

```bash
# .envrc
export GCP_PROJECT_ID="your-gcp-project-id"
export GCP_REGION="us-central1"
# ... other variables
```

Then allow it:
```bash
direnv allow
```

### Option 3: Session-Specific

For temporary use in a single terminal session:

```bash
export GCP_PROJECT_ID="your-gcp-project-id"
# ... other variables
```

## Validation

SuperDeploy commands will validate that required environment variables are set before executing operations. If a required variable is missing, you'll see an error message indicating which variable needs to be set.

Example:
```bash
$ superdeploy up -p acme
‚ùå Missing required environment variable: GCP_PROJECT_ID
```

## Migration from .env File

If you're migrating from the old `.env` file approach:

1. Review your current `superdeploy/.env` file
2. Export the variables listed above to your shell profile
3. Remove project-specific settings (they belong in `project.yml`)
4. Delete the `superdeploy/.env` file

## Security Best Practices

1. **Never commit credentials**: Don't commit `.env` files or credentials to Git
2. **Use access tokens**: Use tokens instead of passwords where possible
3. **Rotate credentials**: Regularly rotate tokens and passwords
4. **Limit permissions**: Use least-privilege access for service accounts
5. **Encrypt at rest**: Consider using a secrets manager for sensitive values

## Troubleshooting

### Variable Not Found

If a command reports a missing variable:

1. Check if it's set: `echo $VARIABLE_NAME`
2. Verify your shell profile is loaded: `source ~/.bashrc`
3. Check for typos in variable names

### Wrong Value

If a variable has the wrong value:

1. Check which file sets it: `grep -r "VARIABLE_NAME" ~/.bashrc ~/.zshrc`
2. Ensure no conflicting definitions exist
3. Reload your shell after making changes

## See Also

- [Project Configuration](CONFIGURATION.md) - Per-project settings in `project.yml`
- [Setup Guide](SETUP.md) - Initial setup instructions
- [Architecture](ARCHITECTURE.md) - System architecture overview
