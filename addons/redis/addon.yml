# Redis Addon Metadata
name: redis
description: Redis in-memory data store and cache
version: "7-alpine"
category: cache

# Resource plans (small/standard/large/xlarge)
plans:
  small:
    memory: 128M
    cpu: 0.25
    disk: 2G
    maxmemory: 64mb
    maxmemory_policy: allkeys-lru
    description: "For development/small caches"
    
  standard:
    memory: 256M
    cpu: 0.5
    disk: 5G
    maxmemory: 128mb
    maxmemory_policy: allkeys-lru
    description: "For production caches"
    
  large:
    memory: 1G
    cpu: 1.0
    disk: 10G
    maxmemory: 512mb
    maxmemory_policy: allkeys-lru
    description: "For high-traffic caching"
    
  xlarge:
    memory: 2G
    cpu: 2.0
    disk: 20G
    maxmemory: 1gb
    maxmemory_policy: allkeys-lru
    description: "For enterprise caching"

# Environment variable template (uses {INSTANCE} placeholder)
env_template:
  - name: "{INSTANCE}_URL"
    description: "Full connection URL"
    format: "redis://default:{PASSWORD}@{HOST}:{PORT}"
    
  - name: "{INSTANCE}_HOST"
    description: "Redis hostname"
    
  - name: "{INSTANCE}_PORT"
    description: "Redis port"
    
  - name: "{INSTANCE}_PASSWORD"
    description: "Redis password"
    secret: true
    
  - name: "{INSTANCE}_DB"
    description: "Redis database number"
    default: "0"

# Port allocation strategy
port_allocation:
  base_port: 6379
  increment: 1  # Second instance: 6380, Third: 6381

# Docker compose configuration
compose:
  volumes:
    - redis-data
  ports: []
  networks:
    - project-network
  expose:
    - "6379"

# Resource requirements
resources:
  memory: 256M
  cpu: 0.25
  disk: 5G

# Health check
healthcheck:
  command: 'redis-cli --no-auth-warning -a "$REDIS_PASSWORD" ping'
  interval: 10s
  timeout: 5s
  retries: 5
  start_period: 10s

# Dependencies (other addons required)
requires: []

# Conflicts (cannot coexist with)
conflicts: []

# Tags for monitoring
monitoring:
  enabled: true
  metrics_port: 9121
  dashboard: redis-overview.json
