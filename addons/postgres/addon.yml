# PostgreSQL Addon Metadata
name: postgres
description: PostgreSQL relational database
version: "15-alpine"
category: database

# Resource plans (small/standard/large/xlarge)
plans:
  small:
    memory: 256M
    cpu: 0.25
    disk: 5G
    max_connections: 50
    shared_buffers: 64MB
    description: "For development/testing"
    
  standard:
    memory: 512M
    cpu: 0.5
    disk: 10G
    max_connections: 100
    shared_buffers: 128MB
    description: "For production workloads"
    
  large:
    memory: 1G
    cpu: 1.0
    disk: 20G
    max_connections: 200
    shared_buffers: 256MB
    description: "For high-traffic production"
    
  xlarge:
    memory: 2G
    cpu: 2.0
    disk: 50G
    max_connections: 500
    shared_buffers: 512MB
    description: "For enterprise workloads"

# Environment variable template (uses {INSTANCE} placeholder)
env_template:
  - name: "{INSTANCE}_URL"
    description: "Full connection URL"
    format: "postgresql://{USER}:{PASSWORD}@{HOST}:{PORT}/{DATABASE}"
    
  - name: "{INSTANCE}_HOST"
    description: "PostgreSQL hostname"
    
  - name: "{INSTANCE}_PORT"
    description: "PostgreSQL port"
    
  - name: "{INSTANCE}_USER"
    description: "Database username"
    
  - name: "{INSTANCE}_PASSWORD"
    description: "Database password"
    secret: true
    
  - name: "{INSTANCE}_DATABASE"
    description: "Database name"

# Readonly connection (for read replicas / readonly access)
readonly_env_template:
  - name: "{INSTANCE}_READONLY_URL"
    format: "postgresql://{READONLY_USER}:{READONLY_PASSWORD}@{HOST}:{PORT}/{DATABASE}"
  - name: "{INSTANCE}_READONLY_USER"
  - name: "{INSTANCE}_READONLY_PASSWORD"
    secret: true

# Port allocation strategy
port_allocation:
  base_port: 5432
  increment: 1  # Second instance: 5433, Third: 5434

# Docker compose configuration
compose:
  volumes:
    - postgres-data
  ports: []
  networks:
    - project-network
  expose:
    - "5432"

# Resource requirements
resources:
  memory: 512M
  cpu: 0.5
  disk: 10G

# Health check
healthcheck:
  command: "pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB}"
  interval: 10s
  timeout: 5s
  retries: 5
  start_period: 30s

# Dependencies (other addons required)
requires: []

# Conflicts (cannot coexist with)
conflicts: []

# Tags for monitoring
monitoring:
  enabled: true
  metrics_port: 9187
  dashboard: postgres-overview.json
