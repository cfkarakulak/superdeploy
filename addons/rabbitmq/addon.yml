# RabbitMQ Addon Metadata
name: rabbitmq
description: RabbitMQ message broker and queue system
version: "3.12-management-alpine"
category: queue

# Resource plans (small/standard/large/xlarge)
plans:
  small:
    memory: 256M
    cpu: 0.25
    disk: 5G
    max_connections: 100
    description: "For development/low-traffic"
    
  standard:
    memory: 512M
    cpu: 0.5
    disk: 10G
    max_connections: 500
    description: "For production workloads"
    
  large:
    memory: 1G
    cpu: 1.0
    disk: 20G
    max_connections: 1000
    description: "For high-traffic queues"
    
  xlarge:
    memory: 2G
    cpu: 2.0
    disk: 50G
    max_connections: 2000
    description: "For enterprise message queues"

# Environment variable template (uses {INSTANCE} placeholder)
env_template:
  - name: "{INSTANCE}_URL"
    description: "Full AMQP connection URL"
    format: "amqp://{USER}:{PASSWORD}@{HOST}:{PORT}{VHOST}"
    
  - name: "{INSTANCE}_HOST"
    description: "RabbitMQ hostname"
    
  - name: "{INSTANCE}_PORT"
    description: "RabbitMQ AMQP port"
    
  - name: "{INSTANCE}_USER"
    description: "RabbitMQ username"
    
  - name: "{INSTANCE}_PASSWORD"
    description: "RabbitMQ password"
    secret: true
    
  - name: "{INSTANCE}_VHOST"
    description: "RabbitMQ virtual host"
    default: "/"

# Port allocation strategy
port_allocation:
  base_port: 5672
  increment: 1  # Second instance: 5673, Third: 5674

# Docker compose configuration
compose:
  volumes:
    - rabbitmq-data
  ports: []
  networks:
    - project-network
  expose:
    - "5672"
    - "15672"

# Resource requirements
resources:
  memory: 512M
  cpu: 0.5
  disk: 10G

# Health check
healthcheck:
  command: "rabbitmq-diagnostics -q ping"
  interval: 10s
  timeout: 10s
  retries: 30
  start_period: 90s

# Dependencies (other addons required)
requires: []

# Conflicts (cannot coexist with)
conflicts: []

# Tags for monitoring
monitoring:
  enabled: true
  metrics_port: 15692
  dashboard: rabbitmq-overview.json
