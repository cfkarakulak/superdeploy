# Caddy Addon Metadata
name: caddy
description: Caddy reverse proxy with automatic HTTPS
version: "2-alpine"
category: proxy

# Resource plans (small/standard/large/xlarge)
plans:
  small:
    memory: 64M
    cpu: 0.1
    disk: 1G
    description: "For development/low traffic"
    
  standard:
    memory: 128M
    cpu: 0.25
    disk: 2G
    description: "For production proxying"
    
  large:
    memory: 256M
    cpu: 0.5
    disk: 5G
    description: "For high-traffic proxying"
    
  xlarge:
    memory: 512M
    cpu: 1.0
    disk: 10G
    description: "For enterprise proxying"

# Environment variable template (uses {INSTANCE} placeholder)
env_template:
  - name: "{INSTANCE}_EMAIL"
    description: "Email for Let's Encrypt certificate notifications"
    default: "admin@example.com"
    
  - name: "{INSTANCE}_HTTP_PORT"
    description: "HTTP port for Caddy"
    default: "80"
    
  - name: "{INSTANCE}_HTTPS_PORT"
    description: "HTTPS port for Caddy"
    default: "443"
    
  - name: "{INSTANCE}_ADMIN_PORT"
    description: "Caddy admin API port"
    default: "2019"

# Port allocation strategy
# Note: Caddy typically uses fixed ports (80, 443)
port_allocation:
  base_port: 80
  increment: 0  # Caddy instances usually share same external ports

# Docker compose configuration
compose:
  volumes:
    - caddy-data
    - caddy-config
  ports:
    - "80:80"
    - "443:443"
    - "2019:2019"
  networks:
    - project-network
  expose:
    - "80"
    - "443"
    - "2019"

# Resource requirements
resources:
  memory: 128M
  cpu: 0.1
  disk: 1G

# Health check
healthcheck:
  command: "wget --no-verbose --tries=1 --spider http://localhost:2019/config/ || exit 1"
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 10s

# Dependencies (other addons required)
requires: []

# Conflicts (cannot coexist with)
conflicts:
  - nginx

# Tags for monitoring
monitoring:
  enabled: true
  metrics_port: 2019
  dashboard: caddy-overview.json
