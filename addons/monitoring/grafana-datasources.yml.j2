# Grafana Datasource Provisioning
# Auto-generated by SuperDeploy for all projects

apiVersion: 1

datasources:
  # Main Prometheus datasource (all projects)
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: false
    jsonData:
      timeInterval: '15s'
      queryTimeout: '60s'
      httpMethod: 'POST'
    uid: prometheus-main

{% for project in projects %}
  # Project-specific datasource: {{ project.name }}
  - name: '{{ project.name | title }} - Prometheus'
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: false
    editable: false
    jsonData:
      timeInterval: '15s'
      queryTimeout: '60s'
      httpMethod: 'POST'
      # Pre-filter queries to this project
      customQueryParameters: 'project={{ project.name }}'
    uid: 'prometheus-{{ project.name }}'
    # Add project metadata
    jsonData:
      customLabels:
        project: '{{ project.name }}'
        environment: '{{ project.environment | default("production") }}'
{% if project.tags is defined %}
{% for tag in project.tags %}
        tag_{{ loop.index }}: '{{ tag }}'
{% endfor %}
{% endif %}

{% endfor %}

  # Loki datasource (if logs are enabled)
{% if loki_enabled | default(false) %}
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    isDefault: false
    editable: false
    jsonData:
      maxLines: 1000
    uid: loki-main
{% endif %}
