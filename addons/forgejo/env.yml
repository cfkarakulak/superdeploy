# Environment variables for Forgejo addon
# This file defines how environment variables are sourced and mapped

variables:
  # Forgejo Version
  FORGEJO_VERSION:
    source: config
    value: "13"
    description: "Forgejo Docker image version"
    from_project: "addons.forgejo.version"
    default: "13"
  
  # Network Configuration
  FORGEJO_PORT:
    source: config
    value: "3001"
    description: "Forgejo web interface port"
    from_project: "addons.forgejo.port"
    default: "3001"
    required: true
  
  FORGEJO_SSH_PORT:
    source: config
    value: "2222"
    description: "Git SSH access port"
    from_project: "addons.forgejo.ssh_port"
    default: "2222"
    required: true
  
  # Admin User Configuration
  FORGEJO_ADMIN_USER:
    source: config
    value: "admin"
    description: "Forgejo admin username"
    from_project: "addons.forgejo.admin_user"
    default: "admin"
    required: true
  
  FORGEJO_ADMIN_PASSWORD:
    source: secret
    value: "${FORGEJO_ADMIN_PASSWORD}"
    description: "Forgejo admin password (auto-generated)"
    from_secrets: "FORGEJO_ADMIN_PASSWORD"
    required: true
    generate: true
  
  FORGEJO_ADMIN_EMAIL:
    source: config
    value: "admin@${PROJECT}.local"
    description: "Forgejo admin email address"
    from_project: "addons.forgejo.admin_email"
    default: "admin@${PROJECT}.local"
    required: true
  
  # Organization and Repository
  FORGEJO_ORG:
    source: config
    value: ""
    description: "Forgejo organization name"
    from_project: "addons.forgejo.org"
    required: true
  
  FORGEJO_REPO:
    source: config
    value: "superdeploy"
    description: "Forgejo repository name"
    from_project: "addons.forgejo.repo"
    default: "superdeploy"
    required: true
  
  # Database Configuration
  FORGEJO_DB_NAME:
    source: config
    value: "forgejo"
    description: "PostgreSQL database name for Forgejo"
    from_project: "addons.forgejo.db_name"
    default: "forgejo"
    required: true
  
  FORGEJO_DB_USER:
    source: config
    value: "forgejo"
    description: "PostgreSQL database user for Forgejo"
    from_project: "addons.forgejo.db_user"
    default: "forgejo"
    required: true
  
  FORGEJO_DB_PASSWORD:
    source: secret
    value: "${FORGEJO_DB_PASSWORD}"
    description: "PostgreSQL database password (auto-generated)"
    from_secrets: "FORGEJO_DB_PASSWORD"
    required: true
    generate: true
  
  # Security Keys
  FORGEJO_SECRET_KEY:
    source: secret
    value: "${FORGEJO_SECRET_KEY}"
    description: "Forgejo secret key for encryption (auto-generated)"
    from_secrets: "FORGEJO_SECRET_KEY"
    required: true
    generate: true
    length: 64
  
  FORGEJO_INTERNAL_TOKEN:
    source: secret
    value: "${FORGEJO_INTERNAL_TOKEN}"
    description: "Forgejo internal API token (auto-generated)"
    from_secrets: "FORGEJO_INTERNAL_TOKEN"
    required: true
    generate: true
    length: 105
  
  # Server Configuration (Runtime)
  FORGEJO_DOMAIN:
    source: runtime
    value: "${ANSIBLE_HOST}"
    description: "Forgejo server domain/IP (resolved at runtime)"
    from_ansible: "ansible_host"
    required: true
  
  FORGEJO_EXTERNAL_IP:
    source: runtime
    value: "${ANSIBLE_HOST}"
    description: "External IP address for Forgejo (resolved at runtime)"
    from_ansible: "ansible_host"
    required: true

# GitHub Actions secrets mapping
github_secrets:
  - FORGEJO_ADMIN_USER
  - FORGEJO_ADMIN_PASSWORD
  - FORGEJO_ORG
  - FORGEJO_REPO
  - FORGEJO_DB_PASSWORD
  - FORGEJO_SECRET_KEY
  - FORGEJO_INTERNAL_TOKEN

# Forgejo Actions secrets mapping
forgejo_secrets:
  - FORGEJO_ADMIN_USER
  - FORGEJO_ADMIN_PASSWORD
  - FORGEJO_ORG
  - FORGEJO_REPO
  - FORGEJO_DB_PASSWORD
  - FORGEJO_SECRET_KEY
  - FORGEJO_INTERNAL_TOKEN
  - DOCKER_USERNAME
  - DOCKER_TOKEN
